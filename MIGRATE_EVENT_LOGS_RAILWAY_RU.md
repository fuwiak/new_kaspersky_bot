# –ú–∏–≥—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã event_logs –Ω–∞ Railway

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `event_logs` –Ω–∞ Railway PostgreSQL.

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã

–¢–∞–±–ª–∏—Ü–∞ `event_logs` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ:

- `id` - SERIAL PRIMARY KEY (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)
- `event` - TEXT NOT NULL (—Ç–∏–ø —Å–æ–±—ã—Ç–∏—è)
- `metadata` - TEXT (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON)
- `userId` - INTEGER (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `occurredAt` - TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP (–≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è)

**–ò–Ω–¥–µ–∫—Å:** `event_logs_event_idx` –Ω–∞ –ø–æ–ª–µ `event`

## üöÄ –°–ø–æ—Å–æ–±—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Railway Shell (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø) ‚≠ê

–≠—Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –≤ [Railway Dashboard](https://railway.app/dashboard)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à **—Å–µ—Ä–≤–∏—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (–Ω–µ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"Deployments"**
4. –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ
5. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Shell"** –∏–ª–∏ **"Open Shell"** (–æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Ç–µ—Ä–º–∏–Ω–∞–ª)
6. –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
node scripts/migrate-event-logs-railway.js
```

–∏–ª–∏

```bash
bash scripts/migrate-event-logs-railway.sh
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ Railway —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å TCP Proxy

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ Railway CLI

–ï—Å–ª–∏ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Railway CLI:

```bash
railway link  # –µ—Å–ª–∏ –µ—â–µ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ
railway run node scripts/migrate-event-logs-railway.js
```

–∏–ª–∏

```bash
railway run bash scripts/migrate-event-logs-railway.sh
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –î–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ `railway run` –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –≤–∫–ª—é—á–∏—Ç—å TCP Proxy –¥–ª—è PostgreSQL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Railway.

### –°–ø–æ—Å–æ–± 3: –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ psql (–¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å PostgreSQL (–Ω–∞–ø—Ä–∏–º–µ—Ä, `interchange.proxy.rlwy.net:31058`):

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–ª–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ Railway Dashboard
# PostgreSQL —Å–µ—Ä–≤–∏—Å ‚Üí Connect ‚Üí Connection Pooling –∏–ª–∏ Private Networking
# –§–æ—Ä–º–∞—Ç: postgresql://postgres:PASSWORD@interchange.proxy.rlwy.net:31058/railway

psql "postgresql://postgres:–í–ê–®_–ü–ê–†–û–õ–¨@interchange.proxy.rlwy.net:31058/railway" \
  -f scripts/apply-event-logs-migration-direct.sql
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–æ–ª—å (–∑–∞–º–µ–Ω–∏—Ç–µ –í–ê–®_–ü–ê–†–û–õ–¨ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å)
export PGPASSWORD=–í–ê–®_–ü–ê–†–û–õ–¨

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
psql -h interchange.proxy.rlwy.net \
     -p 31058 \
     -U postgres \
     -d railway \
     -f scripts/apply-event-logs-migration-direct.sql
```

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º

```bash
psql -h interchange.proxy.rlwy.net -p 31058 -U postgres -d railway
```

–ó–∞—Ç–µ–º –≤ psql –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
\i scripts/apply-event-logs-migration-direct.sql
```

### –°–ø–æ—Å–æ–± 4: –ß–µ—Ä–µ–∑ Prisma (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

–ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Prisma:

```bash
# –í Railway Shell –∏–ª–∏ —á–µ—Ä–µ–∑ railway run
npx prisma db push
```

–≠—Ç–æ –ø—Ä–∏–º–µ–Ω–∏—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ `schema.prisma`, –≤–∫–ª—é—á–∞—è —Ç–∞–±–ª–∏—Ü—É `event_logs`.

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞:

### –í Railway Shell –∏–ª–∏ —á–µ—Ä–µ–∑ psql:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
AND table_name = 'event_logs';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
SELECT
    column_name,
    data_type,
    is_nullable,
    column_default
FROM information_schema.columns
WHERE table_schema = 'public'
AND table_name = 'event_logs'
ORDER BY ordinal_position;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤
SELECT indexname
FROM pg_indexes
WHERE schemaname = 'public'
AND tablename = 'event_logs';
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

**–¢–∞–±–ª–∏—Ü–∞:**
- ‚úÖ `event_logs` –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

**–°—Ç–æ–ª–±—Ü—ã:**
- `id` - integer, NOT NULL, PRIMARY KEY
- `event` - text, NOT NULL
- `metadata` - text, nullable
- `userId` - integer, nullable
- `occurredAt` - timestamp without time zone, NOT NULL, DEFAULT now()

**–ò–Ω–¥–µ–∫—Å—ã:**
- ‚úÖ `event_logs_event_idx` –Ω–∞ –ø–æ–ª–µ `event`

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "DATABASE_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–°–ø–æ—Å–æ–± 1** (Railway Shell) - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–°–ø–æ—Å–æ–± 2** —Å `railway run`

### –û—à–∏–±–∫–∞: "—Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"

**–†–µ—à–µ–Ω–∏–µ:**
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –µ—ë –ø–æ–≤—Ç–æ—Ä–Ω–æ
- –ú–∏–≥—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

### –û—à–∏–±–∫–∞: "Could not connect to database"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PostgreSQL —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω –≤ Railway
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è –≤ —Å—Ç—Ä–æ–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –û—à–∏–±–∫–∞: "psql: command not found"

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–°–ø–æ—Å–æ–± 1** (Railway Shell) - —Ç–∞–º –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–°–ø–æ—Å–æ–± 4** (Prisma) - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç psql

### –û—à–∏–±–∫–∞: "Cannot find module 'pg'"

**–†–µ—à–µ–Ω–∏–µ:**
- –í Railway Shell –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: `yarn install` –∏–ª–∏ `npm install`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–°–ø–æ—Å–æ–± 3** (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ psql)

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ `server/prisma/schema.prisma` (—Å—Ç—Ä–æ–∫–∏ 267-275)
- –ú–æ–¥–µ–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—Ü–µ–π: `server/models/eventLogs.js`
- SQL —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏: `server/prisma/migrations/create_event_logs_postgresql.sql`

## ‚úÖ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü–∞ `event_logs` –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–Ω–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ —ç—Ç—É —Ç–∞–±–ª–∏—Ü—É.

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ Collector –∏–∑ Server

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–°–µ—Ä–≤–µ—Ä —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç collector –∫–∞–∫ child process –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤ production/docker —Ä–µ–∂–∏–º–µ.

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫
- Collector –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –≤ production/docker —Ä–µ–∂–∏–º–µ
- –í development —Ä–µ–∂–∏–º–µ collector **–Ω–µ** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é)

### ‚úÖ –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- –°–µ—Ä–≤–µ—Ä –∂–¥–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ collector (–º–∞–∫—Å–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥) –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –ø—Ä–∏–µ–º–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ `/ping` endpoint
- –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

### ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í—Å–µ –ª–æ–≥–∏ collector –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `[COLLECTOR]` –¥–ª—è –ª–µ–≥–∫–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –õ–æ–≥–∏ collector –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ stdout/stderr —Å–µ—Ä–≤–µ—Ä–∞ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–ø—É—Å–∫–∞ collector

### ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ï—Å–ª–∏ collector –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è, —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
- –ï—Å–ª–∏ collector —É–ø–∞–¥–µ—Ç, —ç—Ç–æ –±—É–¥–µ—Ç –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–æ
- –°–µ—Ä–≤–µ—Ä –Ω–µ –ø–∞–¥–∞–µ—Ç, –µ—Å–ª–∏ collector –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å)

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### `server/utils/boot/startCollector.js`
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[COLLECTOR]`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ `/ping` endpoint
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–∂–∏–¥–∞–Ω–∏—è

### `server/utils/boot/index.js`
- –í—ã–∑—ã–≤–∞–µ—Ç `startCollector()` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–µ—Ä–≤–µ—Ä–∞
- –û–∂–∏–¥–∞–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ collector –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –ø—Ä–∏–µ–º–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–ø—É—Å–∫–∞

### `collector/index.js`
- –î–æ–±–∞–≤–ª–µ–Ω `/ping` endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è
- Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ status: "ok", service: "collector" }`

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í Production/Docker —Ä–µ–∂–∏–º–µ:

1. –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `startCollector()` –∏–∑ `server/utils/boot/index.js`
3. Collector –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ child process
4. –°–µ—Ä–≤–µ—Ä –∂–¥–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ collector (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç `/ping` endpoint)
5. –ü–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ collector (–∏–ª–∏ —Ç–∞–π–º–∞—É—Ç–∞ 30 —Å–µ–∫—É–Ω–¥) —Å–µ—Ä–≤–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### –í Development —Ä–µ–∂–∏–º–µ:

1. –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
2. `startCollector()` –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∑–∞–ø—É—Å–∫ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`)
3. Collector –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é: `cd collector && yarn dev`

## üìä –ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

```
[CollectorManager] Starting collector process...
[CollectorManager]   Runtime: docker
[CollectorManager]   NODE_ENV: production
[CollectorManager]   Port: 8888
[CollectorManager] Spawning collector from: /app/collector
[COLLECTOR] Starting document processor...
[COLLECTOR] Port: 8888
[COLLECTOR] NODE_ENV: production
[COLLECTOR] Working directory: /app/collector
[COLLECTOR] Node version: v20.20.0
[COLLECTOR] ‚úì Server listening on 0.0.0.0:8888
[COLLECTOR] ‚úì Document processor app listening on port 8888
[COLLECTOR] ‚úì Ready to accept connections
[COLLECTOR] ‚úì Storage initialized
[CollectorManager] Waiting for collector to be ready (max 30 seconds)...
[CollectorManager] Collector became ready after 1.2s (attempt 3/60)
[CollectorManager] ‚úì Collector is ready and responding on port 8888
[Boot] ‚úì Collector is ready, starting server...
[Boot] ‚úì Primary server in HTTP mode listening on port 8080
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- `NODE_ENV=production` - –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ collector
- `COLLECTOR_PORT=8888` - –ø–æ—Ä—Ç –¥–ª—è collector (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8888)
- `ANYTHING_LLM_RUNTIME=docker` - —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ –∑–∞–ø—É—Å–∫–µ collector
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ collector –æ—Ç–≤–µ—á–∞–µ—Ç: `curl http://localhost:8888/ping`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å—ã `[COLLECTOR]` –∏ `[CollectorManager]`

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Development —Ä–µ–∂–∏–º**: –í development collector –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. **–¢–∞–π–º–∞—É—Ç**: –ï—Å–ª–∏ collector –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∑–∞ 30 —Å–µ–∫—É–Ω–¥, —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É
3. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤**: –ï—Å–ª–∏ collector –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
4. **–õ–æ–≥–∏**: –í—Å–µ –ª–æ–≥–∏ collector –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `[COLLECTOR]` –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

## üêõ Troubleshooting

### Collector –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `NODE_ENV=production`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ collector —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `/app/collector` –∏–ª–∏ `../collector`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### Collector –Ω–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥–æ—Ç–æ–≤—ã–º:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 8888 —Å–≤–æ–±–æ–¥–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ collector –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- –£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç –≤ `startCollector.js` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 —Å–µ–∫—É–Ω–¥)

### –õ–æ–≥–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ collector –∑–∞–ø—É—â–µ–Ω –∫–∞–∫ child process
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ª–æ–≥–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
